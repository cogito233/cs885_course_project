[05:33:50] ======================================================================
[05:33:50] ğŸ”¬ Stateful KV Cache ç‰ˆæœ¬ - Regex Force Generate + Sleep Env Time
[05:33:50] ======================================================================
[05:33:50] ğŸš€ æ ¸å¿ƒä¼˜åŒ–: é¿å…æ¯è½® full prefillï¼ŒRuntime è‡ªåŠ¨å¤ç”¨ KV
[05:33:50]    â†’ èŠ‚çœ >99% çš„ prefill è®¡ç®—ï¼Œé¢„è®¡ååæå‡ 3-4x
[05:33:50] ğŸ’¡ Regex Force Generate: ä½¿ç”¨regexé”æ­»è¾“å‡ºä¸ºåŸå§‹response
[05:33:50]    â†’ æ—¢æœ‰çœŸå®çš„generateæ—¶é—´ï¼Œåˆç¡®ä¿è¾“å‡ºå®Œå…¨ä¸€è‡´
[05:33:50] â±ï¸  Sleep Env Time: æ¯è½®ä¹‹é—´sleepç¯å¢ƒæ‰§è¡Œæ—¶é—´ï¼ˆæ¨¡æ‹ŸçœŸå®åœºæ™¯ï¼‰
[05:33:50] ğŸ“Š è¿½è¸ª: æ»‘åŠ¨çª—å£ååé‡ï¼ˆ10ç§’çª—å£ï¼Œå¸¦è¡°å‡ï¼‰
[05:33:50] ======================================================================
[05:33:50] ğŸ¤– æ¨¡å‹: Qwen2.5-14B (128kä¸Šä¸‹æ–‡)
[05:33:50] ğŸ¯ é…ç½®: GPU 2 | 50æ¡è½¨è¿¹ | 50è½®å¯¹è¯
[05:33:50] ğŸ”¢ æµ‹è¯•: Batch Size = [6, 8]
[05:33:50] ======================================================================
[05:33:50] 
[1/3] åŠ è½½...
[05:33:50] âœ“ 50æ¡è½¨è¿¹
[05:33:50] 
[2/3] åŠ è½½æ¨¡å‹...
[05:33:50] ä¼˜åŒ–é…ç½®: æé«˜æ˜¾å­˜åˆ©ç”¨ç‡
[05:33:50] ä½¿ç”¨ç«¯å£: 30020
/minimax-dialogue/users/ruobai/cogito_dev/course_project_854/.venv/lib/python3.11/site-packages/transformers/utils/hub.py:110: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
[2025-11-27 05:34:00] WARNING server_args.py:1213: Attention backend not explicitly specified. Use fa3 backend by default.
/minimax-dialogue/users/ruobai/cogito_dev/course_project_854/.venv/lib/python3.11/site-packages/transformers/utils/hub.py:110: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
/minimax-dialogue/users/ruobai/cogito_dev/course_project_854/.venv/lib/python3.11/site-packages/transformers/utils/hub.py:110: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
/minimax-dialogue/users/ruobai/cogito_dev/course_project_854/.venv/lib/python3.11/site-packages/transformers/utils/hub.py:110: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
Loading safetensors checkpoint shards:   0% Completed | 0/8 [00:00<?, ?it/s]
Loading safetensors checkpoint shards:  12% Completed | 1/8 [00:00<00:05,  1.38it/s]
Loading safetensors checkpoint shards:  25% Completed | 2/8 [00:01<00:04,  1.26it/s]
Loading safetensors checkpoint shards:  38% Completed | 3/8 [00:02<00:04,  1.24it/s]
Loading safetensors checkpoint shards:  50% Completed | 4/8 [00:03<00:03,  1.21it/s]
Loading safetensors checkpoint shards:  62% Completed | 5/8 [00:04<00:02,  1.20it/s]
Loading safetensors checkpoint shards:  75% Completed | 6/8 [00:04<00:01,  1.19it/s]
Loading safetensors checkpoint shards:  88% Completed | 7/8 [00:05<00:00,  1.19it/s]
Loading safetensors checkpoint shards: 100% Completed | 8/8 [00:06<00:00,  1.40it/s]
Loading safetensors checkpoint shards: 100% Completed | 8/8 [00:06<00:00,  1.28it/s]

  0%|          | 0/36 [00:00<?, ?it/s]Capturing batches (bs=256 avail_mem=85.85 GB):   0%|          | 0/36 [00:00<?, ?it/s]Capturing batches (bs=256 avail_mem=85.85 GB):   3%|â–         | 1/36 [00:00<00:06,  5.12it/s]Capturing batches (bs=248 avail_mem=85.70 GB):   3%|â–         | 1/36 [00:00<00:06,  5.12it/s]Capturing batches (bs=240 avail_mem=85.69 GB):   3%|â–         | 1/36 [00:00<00:06,  5.12it/s]Capturing batches (bs=240 avail_mem=85.69 GB):   8%|â–Š         | 3/36 [00:00<00:03, 10.22it/s]Capturing batches (bs=232 avail_mem=85.68 GB):   8%|â–Š         | 3/36 [00:00<00:03, 10.22it/s]Capturing batches (bs=224 avail_mem=85.68 GB):   8%|â–Š         | 3/36 [00:00<00:03, 10.22it/s]Capturing batches (bs=224 avail_mem=85.68 GB):  14%|â–ˆâ–        | 5/36 [00:00<00:02, 12.05it/s]Capturing batches (bs=216 avail_mem=85.67 GB):  14%|â–ˆâ–        | 5/36 [00:00<00:02, 12.05it/s]Capturing batches (bs=208 avail_mem=85.66 GB):  14%|â–ˆâ–        | 5/36 [00:00<00:02, 12.05it/s]Capturing batches (bs=208 avail_mem=85.66 GB):  19%|â–ˆâ–‰        | 7/36 [00:00<00:02, 13.27it/s]Capturing batches (bs=200 avail_mem=85.65 GB):  19%|â–ˆâ–‰        | 7/36 [00:00<00:02, 13.27it/s]Capturing batches (bs=192 avail_mem=85.65 GB):  19%|â–ˆâ–‰        | 7/36 [00:00<00:02, 13.27it/s]Capturing batches (bs=192 avail_mem=85.65 GB):  25%|â–ˆâ–ˆâ–Œ       | 9/36 [00:00<00:01, 14.10it/s]Capturing batches (bs=184 avail_mem=85.64 GB):  25%|â–ˆâ–ˆâ–Œ       | 9/36 [00:00<00:01, 14.10it/s]Capturing batches (bs=176 avail_mem=85.63 GB):  25%|â–ˆâ–ˆâ–Œ       | 9/36 [00:00<00:01, 14.10it/s]Capturing batches (bs=176 avail_mem=85.63 GB):  31%|â–ˆâ–ˆâ–ˆ       | 11/36 [00:00<00:01, 14.67it/s]Capturing batches (bs=168 avail_mem=85.62 GB):  31%|â–ˆâ–ˆâ–ˆ       | 11/36 [00:00<00:01, 14.67it/s]Capturing batches (bs=160 avail_mem=85.62 GB):  31%|â–ˆâ–ˆâ–ˆ       | 11/36 [00:00<00:01, 14.67it/s]Capturing batches (bs=160 avail_mem=85.62 GB):  36%|â–ˆâ–ˆâ–ˆâ–Œ      | 13/36 [00:00<00:01, 14.75it/s]Capturing batches (bs=152 avail_mem=85.61 GB):  36%|â–ˆâ–ˆâ–ˆâ–Œ      | 13/36 [00:00<00:01, 14.75it/s]Capturing batches (bs=144 avail_mem=85.60 GB):  36%|â–ˆâ–ˆâ–ˆâ–Œ      | 13/36 [00:01<00:01, 14.75it/s]Capturing batches (bs=144 avail_mem=85.60 GB):  42%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 15/36 [00:01<00:01, 14.70it/s]Capturing batches (bs=136 avail_mem=85.59 GB):  42%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 15/36 [00:01<00:01, 14.70it/s]Capturing batches (bs=128 avail_mem=85.59 GB):  42%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 15/36 [00:01<00:01, 14.70it/s]Capturing batches (bs=128 avail_mem=85.59 GB):  47%|â–ˆâ–ˆâ–ˆâ–ˆâ–‹     | 17/36 [00:01<00:01, 14.71it/s]Capturing batches (bs=120 avail_mem=85.58 GB):  47%|â–ˆâ–ˆâ–ˆâ–ˆâ–‹     | 17/36 [00:01<00:01, 14.71it/s]Capturing batches (bs=112 avail_mem=85.57 GB):  47%|â–ˆâ–ˆâ–ˆâ–ˆâ–‹     | 17/36 [00:01<00:01, 14.71it/s]Capturing batches (bs=112 avail_mem=85.57 GB):  53%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 19/36 [00:01<00:01, 14.81it/s]Capturing batches (bs=104 avail_mem=85.57 GB):  53%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 19/36 [00:01<00:01, 14.81it/s]Capturing batches (bs=96 avail_mem=85.56 GB):  53%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 19/36 [00:01<00:01, 14.81it/s] Capturing batches (bs=96 avail_mem=85.56 GB):  58%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š    | 21/36 [00:01<00:01, 14.60it/s]Capturing batches (bs=88 avail_mem=85.55 GB):  58%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š    | 21/36 [00:01<00:01, 14.60it/s]Capturing batches (bs=80 avail_mem=85.54 GB):  58%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š    | 21/36 [00:01<00:01, 14.60it/s]Capturing batches (bs=80 avail_mem=85.54 GB):  64%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 23/36 [00:01<00:00, 14.46it/s]Capturing batches (bs=72 avail_mem=85.53 GB):  64%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 23/36 [00:01<00:00, 14.46it/s]Capturing batches (bs=64 avail_mem=85.52 GB):  64%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 23/36 [00:01<00:00, 14.46it/s]Capturing batches (bs=64 avail_mem=85.52 GB):  69%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰   | 25/36 [00:01<00:00, 14.53it/s]Capturing batches (bs=56 avail_mem=85.51 GB):  69%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰   | 25/36 [00:01<00:00, 14.53it/s]Capturing batches (bs=48 avail_mem=85.51 GB):  69%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰   | 25/36 [00:01<00:00, 14.53it/s]Capturing batches (bs=48 avail_mem=85.51 GB):  75%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 27/36 [00:01<00:00, 14.79it/s]Capturing batches (bs=40 avail_mem=85.50 GB):  75%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 27/36 [00:01<00:00, 14.79it/s]Capturing batches (bs=32 avail_mem=85.49 GB):  75%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 27/36 [00:01<00:00, 14.79it/s]Capturing batches (bs=32 avail_mem=85.49 GB):  81%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  | 29/36 [00:02<00:00, 14.98it/s]Capturing batches (bs=24 avail_mem=85.48 GB):  81%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  | 29/36 [00:02<00:00, 14.98it/s]Capturing batches (bs=16 avail_mem=85.48 GB):  81%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  | 29/36 [00:02<00:00, 14.98it/s]Capturing batches (bs=16 avail_mem=85.48 GB):  86%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ | 31/36 [00:02<00:00, 13.55it/s]Capturing batches (bs=12 avail_mem=85.47 GB):  86%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ | 31/36 [00:02<00:00, 13.55it/s]Capturing batches (bs=8 avail_mem=85.46 GB):  86%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ | 31/36 [00:02<00:00, 13.55it/s] Capturing batches (bs=8 avail_mem=85.46 GB):  92%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 33/36 [00:02<00:00, 14.28it/s]Capturing batches (bs=4 avail_mem=85.45 GB):  92%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 33/36 [00:02<00:00, 14.28it/s]Capturing batches (bs=2 avail_mem=85.45 GB):  92%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 33/36 [00:02<00:00, 14.28it/s]Capturing batches (bs=2 avail_mem=85.45 GB):  97%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹| 35/36 [00:02<00:00, 15.26it/s]Capturing batches (bs=1 avail_mem=85.44 GB):  97%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹| 35/36 [00:02<00:00, 15.26it/s]Capturing batches (bs=1 avail_mem=85.44 GB): 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 36/36 [00:02<00:00, 14.24it/s]
[05:34:34] âœ“ 44.0ç§’
[05:34:34] 
GPU 2æ˜¾å­˜ä½¿ç”¨:
2, 55734, 143771
[05:34:34] 
ğŸ’¡ æ ¸å¿ƒä¼˜åŒ–è¯´æ˜:
[05:34:34]   ã€Stateful KV Cache - æœ€å…³é”®ä¼˜åŒ–ã€‘
[05:34:34]     â€¢ ä¸€æ¬¡æ€§å®šä¹‰æ•´ä¸ªå¤šè½®å¯¹è¯æµç¨‹
[05:34:34]     â€¢ Runtime å†…éƒ¨ç»´æŠ¤ KV stateï¼Œé¿å…æ¯è½® full prefill
[05:34:34]     â€¢ é¦–è½® prefill + åç»­åª decodeï¼Œå¤§å¹…é™ä½è®¡ç®—å¼€é”€ï¼ˆèŠ‚çœ >99% prefillï¼‰
[05:34:34]   ã€Regex Force Generate + Sleep Env Timeã€‘
[05:34:34]     â€¢ Regexé”æ­»è¾“å‡ºï¼šæ—¢æœ‰çœŸå®ç”Ÿæˆæ—¶é—´ï¼Œåˆç¡®ä¿è¾“å‡ºå®Œå…¨ä¸€è‡´
[05:34:34]     â€¢ æ¯è½®ä¹‹é—´sleepç¯å¢ƒæ‰§è¡Œæ—¶é—´ï¼ˆæ¨¡æ‹ŸçœŸå®åœºæ™¯ï¼‰
[05:34:34]   ã€æ˜¾å­˜ç®¡ç†ã€‘
[05:34:34]     â€¢ mem_fraction=0.88: å……åˆ†åˆ©ç”¨æ˜¾å­˜ç©ºé—´ï¼ˆvs é»˜è®¤0.8ï¼‰
[05:34:34]     â€¢ max_total_tokens=131k: æ›´å¤§çš„KV cacheå®¹é‡ï¼ˆæ”¯æŒé•¿å¯¹è¯ï¼‰
[05:34:34]   ã€ååé‡è®¡ç®—ã€‘
[05:34:34]     â€¢ æ»‘åŠ¨çª—å£ï¼ˆ10ç§’ï¼‰ï¼šåæ˜ å½“å‰å®æ—¶æ€§èƒ½
[05:34:34]     â€¢ ç´¯è®¡å¹³å‡ï¼šåæ˜ æ•´ä½“å¹³å‡æ€§èƒ½
[05:34:34]   ã€æ³¨æ„ã€‘
[05:34:34]     â€¢ éƒ¨åˆ†é«˜çº§è°ƒåº¦å‚æ•°å·²æ³¨é‡Šï¼ˆSGLang ç‰ˆæœ¬å…¼å®¹æ€§ï¼‰
[05:34:34]     â€¢ Stateful KV Cache æ˜¯æœ€æ ¸å¿ƒä¼˜åŒ–ï¼Œæ•ˆæœæœ€æ˜¾è‘—
[05:34:34] 
[3/3] æµ‹è¯•...
[05:34:34] 
>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
[05:34:34] Batch Size 6
[05:34:34] 
======================================================================
[05:34:34] æµ‹è¯• Batch Size (å¹¶å‘æ•°): 6
[05:34:34] ======================================================================
[05:34:34] å‡†å¤‡æ•°æ®...
[05:34:34]   å‡†å¤‡: 10/50
[05:34:34]   å‡†å¤‡: 20/50
[05:34:34]   å‡†å¤‡: 30/50
[05:34:34]   å‡†å¤‡: 40/50
[05:34:34]   å‡†å¤‡: 50/50
[05:34:34] âœ“ å‡†å¤‡å®Œæˆ, avg env: 20.22ç§’
[05:34:34] å¼€å§‹å¹¶å‘æ¨ç†ï¼ˆå¹¶å‘æ•°=6ï¼‰...
[05:34:34] ğŸ’¡ Stateful æ¨¡å¼ï¼šRegex Force Generate + Sleep Env Time
[05:34:34]    â†’ Runtime å†…éƒ¨ç»´æŠ¤ KV cacheï¼Œé¿å…é‡å¤ prefillï¼ˆæœ€å…³é”®ä¼˜åŒ–ï¼‰
[05:34:34]    â†’ Regexé”æ­»è¾“å‡ºï¼šæ—¢æœ‰çœŸå®ç”Ÿæˆæ—¶é—´ï¼Œåˆç¡®ä¿è¾“å‡ºå®Œå…¨ä¸€è‡´
[05:34:34]    â†’ æ¯è½®ä¹‹é—´sleepç¯å¢ƒæ‰§è¡Œæ—¶é—´ï¼Œæ¨¡æ‹ŸçœŸå®åœºæ™¯
[05:34:34]    â†’ SGLang è‡ªåŠ¨ dynamic batching å¤„ç†å¹¶å‘è¯·æ±‚
[05:37:53]   è¿›åº¦: 5/50 (10%) | è½¨è¿¹: 0.025æ¡/ç§’ | Token(æ»‘çª—): 189.54tok/ç§’ | Token(ç´¯è®¡): 104.19tok/ç§’ | å·²ç”¨æ—¶: 198.8ç§’
[05:40:02]   è¿›åº¦: 10/50 (20%) | è½¨è¿¹: 0.031æ¡/ç§’ | Token(æ»‘çª—): 117.00tok/ç§’ | Token(ç´¯è®¡): 116.74tok/ç§’ | å·²ç”¨æ—¶: 327.4ç§’
[05:42:14]   è¿›åº¦: 15/50 (30%) | è½¨è¿¹: 0.033æ¡/ç§’ | Token(æ»‘çª—): 91.78tok/ç§’ | Token(ç´¯è®¡): 114.00tok/ç§’ | å·²ç”¨æ—¶: 459.7ç§’
