[06:43:03] ======================================================================
[06:43:03] ğŸ”¬ Stateful KV Cache ç‰ˆæœ¬ - Regex Force Generate + Sleep Env Time
[06:43:03] ======================================================================
[06:43:03] ğŸš€ æ ¸å¿ƒä¼˜åŒ–: é¿å…æ¯è½® full prefillï¼ŒRuntime è‡ªåŠ¨å¤ç”¨ KV
[06:43:03]    â†’ èŠ‚çœ >99% çš„ prefill è®¡ç®—ï¼Œé¢„è®¡ååæå‡ 3-4x
[06:43:03] ğŸ’¡ Regex Force Generate: ä½¿ç”¨regexé”æ­»è¾“å‡ºä¸ºåŸå§‹response
[06:43:03]    â†’ æ—¢æœ‰çœŸå®çš„generateæ—¶é—´ï¼Œåˆç¡®ä¿è¾“å‡ºå®Œå…¨ä¸€è‡´
[06:43:03] â±ï¸  Sleep Env Time: æ¯è½®ä¹‹é—´sleepç¯å¢ƒæ‰§è¡Œæ—¶é—´ï¼ˆæ¨¡æ‹ŸçœŸå®åœºæ™¯ï¼‰
[06:43:03] ğŸ“Š è¿½è¸ª: æ»‘åŠ¨çª—å£ååé‡ï¼ˆ10ç§’çª—å£ï¼Œå¸¦è¡°å‡ï¼‰
[06:43:03] ======================================================================
[06:43:03] ğŸ¤– æ¨¡å‹: Qwen2.5-14B (128kä¸Šä¸‹æ–‡)
[06:43:03] ğŸ¯ é…ç½®: GPU 3 | 50æ¡è½¨è¿¹ | 50è½®å¯¹è¯
[06:43:03] ğŸ”¢ æµ‹è¯•: Batch Size = [16, 64]
[06:43:03] ======================================================================
[06:43:03] 
[1/3] åŠ è½½...
[06:43:03] âœ“ 50æ¡è½¨è¿¹
[06:43:03] 
[2/3] åŠ è½½æ¨¡å‹...
[06:43:03] ä¼˜åŒ–é…ç½®: æé«˜æ˜¾å­˜åˆ©ç”¨ç‡
[06:43:03] ä½¿ç”¨ç«¯å£: 30030
/minimax-dialogue/users/ruobai/cogito_dev/course_project_854/.venv/lib/python3.11/site-packages/transformers/utils/hub.py:110: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
[2025-11-27 06:43:31] WARNING server_args.py:1213: Attention backend not explicitly specified. Use fa3 backend by default.
/minimax-dialogue/users/ruobai/cogito_dev/course_project_854/.venv/lib/python3.11/site-packages/transformers/utils/hub.py:110: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
/minimax-dialogue/users/ruobai/cogito_dev/course_project_854/.venv/lib/python3.11/site-packages/transformers/utils/hub.py:110: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
/minimax-dialogue/users/ruobai/cogito_dev/course_project_854/.venv/lib/python3.11/site-packages/transformers/utils/hub.py:110: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
[Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0
Loading safetensors checkpoint shards:   0% Completed | 0/8 [00:00<?, ?it/s]
Loading safetensors checkpoint shards:  12% Completed | 1/8 [00:00<00:05,  1.25it/s]
Loading safetensors checkpoint shards:  25% Completed | 2/8 [00:01<00:04,  1.25it/s]
Loading safetensors checkpoint shards:  38% Completed | 3/8 [00:02<00:03,  1.32it/s]
Loading safetensors checkpoint shards:  50% Completed | 4/8 [00:03<00:03,  1.33it/s]
Loading safetensors checkpoint shards:  62% Completed | 5/8 [00:03<00:02,  1.35it/s]
Loading safetensors checkpoint shards:  75% Completed | 6/8 [00:04<00:01,  1.36it/s]
Loading safetensors checkpoint shards:  88% Completed | 7/8 [00:05<00:00,  1.36it/s]
Loading safetensors checkpoint shards: 100% Completed | 8/8 [00:05<00:00,  1.63it/s]
Loading safetensors checkpoint shards: 100% Completed | 8/8 [00:05<00:00,  1.43it/s]

  0%|          | 0/36 [00:00<?, ?it/s]Capturing batches (bs=256 avail_mem=85.85 GB):   0%|          | 0/36 [00:00<?, ?it/s]Capturing batches (bs=256 avail_mem=85.85 GB):   3%|â–         | 1/36 [00:00<00:07,  4.97it/s]Capturing batches (bs=248 avail_mem=85.70 GB):   3%|â–         | 1/36 [00:00<00:07,  4.97it/s]Capturing batches (bs=240 avail_mem=85.69 GB):   3%|â–         | 1/36 [00:00<00:07,  4.97it/s]Capturing batches (bs=240 avail_mem=85.69 GB):   8%|â–Š         | 3/36 [00:00<00:03, 10.00it/s]Capturing batches (bs=232 avail_mem=85.68 GB):   8%|â–Š         | 3/36 [00:00<00:03, 10.00it/s]Capturing batches (bs=224 avail_mem=85.68 GB):   8%|â–Š         | 3/36 [00:00<00:03, 10.00it/s]Capturing batches (bs=224 avail_mem=85.68 GB):  14%|â–ˆâ–        | 5/36 [00:00<00:02, 11.77it/s]Capturing batches (bs=216 avail_mem=85.67 GB):  14%|â–ˆâ–        | 5/36 [00:00<00:02, 11.77it/s]Capturing batches (bs=208 avail_mem=85.66 GB):  14%|â–ˆâ–        | 5/36 [00:00<00:02, 11.77it/s]Capturing batches (bs=208 avail_mem=85.66 GB):  19%|â–ˆâ–‰        | 7/36 [00:00<00:02, 12.95it/s]Capturing batches (bs=200 avail_mem=85.65 GB):  19%|â–ˆâ–‰        | 7/36 [00:00<00:02, 12.95it/s]Capturing batches (bs=192 avail_mem=85.65 GB):  19%|â–ˆâ–‰        | 7/36 [00:00<00:02, 12.95it/s]Capturing batches (bs=192 avail_mem=85.65 GB):  25%|â–ˆâ–ˆâ–Œ       | 9/36 [00:00<00:01, 13.92it/s]Capturing batches (bs=184 avail_mem=85.64 GB):  25%|â–ˆâ–ˆâ–Œ       | 9/36 [00:00<00:01, 13.92it/s]Capturing batches (bs=176 avail_mem=85.63 GB):  25%|â–ˆâ–ˆâ–Œ       | 9/36 [00:00<00:01, 13.92it/s]Capturing batches (bs=176 avail_mem=85.63 GB):  31%|â–ˆâ–ˆâ–ˆ       | 11/36 [00:00<00:01, 14.61it/s]Capturing batches (bs=168 avail_mem=85.62 GB):  31%|â–ˆâ–ˆâ–ˆ       | 11/36 [00:00<00:01, 14.61it/s]Capturing batches (bs=160 avail_mem=85.62 GB):  31%|â–ˆâ–ˆâ–ˆ       | 11/36 [00:00<00:01, 14.61it/s]Capturing batches (bs=160 avail_mem=85.62 GB):  36%|â–ˆâ–ˆâ–ˆâ–Œ      | 13/36 [00:00<00:01, 14.71it/s]Capturing batches (bs=152 avail_mem=85.61 GB):  36%|â–ˆâ–ˆâ–ˆâ–Œ      | 13/36 [00:00<00:01, 14.71it/s]Capturing batches (bs=144 avail_mem=85.60 GB):  36%|â–ˆâ–ˆâ–ˆâ–Œ      | 13/36 [00:01<00:01, 14.71it/s]Capturing batches (bs=144 avail_mem=85.60 GB):  42%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 15/36 [00:01<00:01, 14.73it/s]Capturing batches (bs=136 avail_mem=85.59 GB):  42%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 15/36 [00:01<00:01, 14.73it/s]Capturing batches (bs=128 avail_mem=85.59 GB):  42%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 15/36 [00:01<00:01, 14.73it/s]Capturing batches (bs=128 avail_mem=85.59 GB):  47%|â–ˆâ–ˆâ–ˆâ–ˆâ–‹     | 17/36 [00:01<00:01, 14.76it/s]Capturing batches (bs=120 avail_mem=85.58 GB):  47%|â–ˆâ–ˆâ–ˆâ–ˆâ–‹     | 17/36 [00:01<00:01, 14.76it/s]Capturing batches (bs=112 avail_mem=85.57 GB):  47%|â–ˆâ–ˆâ–ˆâ–ˆâ–‹     | 17/36 [00:01<00:01, 14.76it/s]Capturing batches (bs=112 avail_mem=85.57 GB):  53%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 19/36 [00:01<00:01, 14.86it/s]Capturing batches (bs=104 avail_mem=85.57 GB):  53%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 19/36 [00:01<00:01, 14.86it/s]Capturing batches (bs=96 avail_mem=85.56 GB):  53%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 19/36 [00:01<00:01, 14.86it/s] Capturing batches (bs=96 avail_mem=85.56 GB):  58%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š    | 21/36 [00:01<00:01, 14.68it/s]Capturing batches (bs=88 avail_mem=85.55 GB):  58%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š    | 21/36 [00:01<00:01, 14.68it/s]Capturing batches (bs=80 avail_mem=85.54 GB):  58%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š    | 21/36 [00:01<00:01, 14.68it/s]Capturing batches (bs=80 avail_mem=85.54 GB):  64%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 23/36 [00:01<00:00, 14.54it/s]Capturing batches (bs=72 avail_mem=85.53 GB):  64%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 23/36 [00:01<00:00, 14.54it/s]Capturing batches (bs=64 avail_mem=85.52 GB):  64%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 23/36 [00:01<00:00, 14.54it/s]Capturing batches (bs=64 avail_mem=85.52 GB):  69%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰   | 25/36 [00:01<00:00, 14.65it/s]Capturing batches (bs=56 avail_mem=85.51 GB):  69%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰   | 25/36 [00:01<00:00, 14.65it/s]Capturing batches (bs=48 avail_mem=85.51 GB):  69%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰   | 25/36 [00:01<00:00, 14.65it/s]Capturing batches (bs=48 avail_mem=85.51 GB):  75%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 27/36 [00:01<00:00, 14.79it/s]Capturing batches (bs=40 avail_mem=85.50 GB):  75%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 27/36 [00:01<00:00, 14.79it/s]Capturing batches (bs=32 avail_mem=85.49 GB):  75%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 27/36 [00:02<00:00, 14.79it/s]Capturing batches (bs=32 avail_mem=85.49 GB):  81%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  | 29/36 [00:02<00:00, 14.94it/s]Capturing batches (bs=24 avail_mem=85.48 GB):  81%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  | 29/36 [00:02<00:00, 14.94it/s]Capturing batches (bs=16 avail_mem=85.48 GB):  81%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  | 29/36 [00:02<00:00, 14.94it/s]Capturing batches (bs=16 avail_mem=85.48 GB):  86%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ | 31/36 [00:02<00:00, 13.71it/s]Capturing batches (bs=12 avail_mem=85.47 GB):  86%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ | 31/36 [00:02<00:00, 13.71it/s]Capturing batches (bs=8 avail_mem=85.46 GB):  86%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ | 31/36 [00:02<00:00, 13.71it/s] Capturing batches (bs=8 avail_mem=85.46 GB):  92%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 33/36 [00:02<00:00, 14.41it/s]Capturing batches (bs=4 avail_mem=85.45 GB):  92%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 33/36 [00:02<00:00, 14.41it/s]Capturing batches (bs=2 avail_mem=85.45 GB):  92%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 33/36 [00:02<00:00, 14.41it/s]Capturing batches (bs=2 avail_mem=85.45 GB):  97%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹| 35/36 [00:02<00:00, 15.41it/s]Capturing batches (bs=1 avail_mem=85.44 GB):  97%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹| 35/36 [00:02<00:00, 15.41it/s]Capturing batches (bs=1 avail_mem=85.44 GB): 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 36/36 [00:02<00:00, 14.25it/s]
[06:44:06] âœ“ 62.6ç§’
[06:44:06] 
GPU 3æ˜¾å­˜ä½¿ç”¨:
3, 55734, 143771
[06:44:06] 
ğŸ’¡ æ ¸å¿ƒä¼˜åŒ–è¯´æ˜:
[06:44:06]   ã€Stateful KV Cache - æœ€å…³é”®ä¼˜åŒ–ã€‘
[06:44:06]     â€¢ ä¸€æ¬¡æ€§å®šä¹‰æ•´ä¸ªå¤šè½®å¯¹è¯æµç¨‹
[06:44:06]     â€¢ Runtime å†…éƒ¨ç»´æŠ¤ KV stateï¼Œé¿å…æ¯è½® full prefill
[06:44:06]     â€¢ é¦–è½® prefill + åç»­åª decodeï¼Œå¤§å¹…é™ä½è®¡ç®—å¼€é”€ï¼ˆèŠ‚çœ >99% prefillï¼‰
[06:44:06]   ã€Regex Force Generate + Sleep Env Timeã€‘
[06:44:06]     â€¢ Regexé”æ­»è¾“å‡ºï¼šæ—¢æœ‰çœŸå®ç”Ÿæˆæ—¶é—´ï¼Œåˆç¡®ä¿è¾“å‡ºå®Œå…¨ä¸€è‡´
[06:44:06]     â€¢ æ¯è½®ä¹‹é—´sleepç¯å¢ƒæ‰§è¡Œæ—¶é—´ï¼ˆæ¨¡æ‹ŸçœŸå®åœºæ™¯ï¼‰
[06:44:06]   ã€æ˜¾å­˜ç®¡ç†ã€‘
[06:44:06]     â€¢ mem_fraction=0.88: å……åˆ†åˆ©ç”¨æ˜¾å­˜ç©ºé—´ï¼ˆvs é»˜è®¤0.8ï¼‰
[06:44:06]     â€¢ max_total_tokens=131k: æ›´å¤§çš„KV cacheå®¹é‡ï¼ˆæ”¯æŒé•¿å¯¹è¯ï¼‰
[06:44:06]   ã€ååé‡è®¡ç®—ã€‘
[06:44:06]     â€¢ æ»‘åŠ¨çª—å£ï¼ˆ10ç§’ï¼‰ï¼šåæ˜ å½“å‰å®æ—¶æ€§èƒ½
[06:44:06]     â€¢ ç´¯è®¡å¹³å‡ï¼šåæ˜ æ•´ä½“å¹³å‡æ€§èƒ½
[06:44:06]   ã€æ³¨æ„ã€‘
[06:44:06]     â€¢ éƒ¨åˆ†é«˜çº§è°ƒåº¦å‚æ•°å·²æ³¨é‡Šï¼ˆSGLang ç‰ˆæœ¬å…¼å®¹æ€§ï¼‰
[06:44:06]     â€¢ Stateful KV Cache æ˜¯æœ€æ ¸å¿ƒä¼˜åŒ–ï¼Œæ•ˆæœæœ€æ˜¾è‘—
[06:44:06] 
[3/3] æµ‹è¯•...
[06:44:06] 
>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
[06:44:06] Batch Size 16
[06:44:06] 
======================================================================
[06:44:06] æµ‹è¯• Batch Size (å¹¶å‘æ•°): 16
[06:44:06] ======================================================================
[06:44:06] å‡†å¤‡æ•°æ®...
[06:44:06]   å‡†å¤‡: 10/50
[06:44:06]   å‡†å¤‡: 20/50
[06:44:06]   å‡†å¤‡: 30/50
[06:44:06]   å‡†å¤‡: 40/50
[06:44:06]   å‡†å¤‡: 50/50
[06:44:06] âœ“ å‡†å¤‡å®Œæˆ, avg env: 20.22ç§’
[06:44:06] å¼€å§‹å¹¶å‘æ¨ç†ï¼ˆå¹¶å‘æ•°=16ï¼‰...
[06:44:06] ğŸ’¡ Stateful æ¨¡å¼ï¼šRegex Force Generate + Sleep Env Time
[06:44:06]    â†’ Runtime å†…éƒ¨ç»´æŠ¤ KV cacheï¼Œé¿å…é‡å¤ prefillï¼ˆæœ€å…³é”®ä¼˜åŒ–ï¼‰
[06:44:06]    â†’ Regexé”æ­»è¾“å‡ºï¼šæ—¢æœ‰çœŸå®ç”Ÿæˆæ—¶é—´ï¼Œåˆç¡®ä¿è¾“å‡ºå®Œå…¨ä¸€è‡´
[06:44:06]    â†’ æ¯è½®ä¹‹é—´sleepç¯å¢ƒæ‰§è¡Œæ—¶é—´ï¼Œæ¨¡æ‹ŸçœŸå®åœºæ™¯
[06:44:06]    â†’ SGLang è‡ªåŠ¨ dynamic batching å¤„ç†å¹¶å‘è¯·æ±‚
[06:58:30]   è¿›åº¦: 5/50 (10%) | è½¨è¿¹: 0.006æ¡/ç§’ | Token(æ»‘çª—): 47.39tok/ç§’ | Token(ç´¯è®¡): 212.36tok/ç§’ | å·²ç”¨æ—¶: 863.6ç§’
[07:01:15]   è¿›åº¦: 10/50 (20%) | è½¨è¿¹: 0.010æ¡/ç§’ | Token(æ»‘çª—): 313.91tok/ç§’ | Token(ç´¯è®¡): 205.50tok/ç§’ | å·²ç”¨æ—¶: 1029.5ç§’
[07:02:32]   è¿›åº¦: 15/50 (30%) | è½¨è¿¹: 0.014æ¡/ç§’ | Token(æ»‘çª—): 498.75tok/ç§’ | Token(ç´¯è®¡): 212.96tok/ç§’ | å·²ç”¨æ—¶: 1105.7ç§’
